<?php
use Zend\Session\Container;
$sessionLogin = new Container('credo');
$facilityId = array();
use User\Service\CommonService;
$common = new CommonService;
// \Zend\Debug\Debug::dump($result);die;
?>
<div class="bg-body-light">
     <div class="content content-full">
          <div class="d-flex flex-column flex-sm-row justify-content-sm-between align-items-sm-center">
               <h1 class="flex-sm-fill font-size-h2 font-w400 mt-2 mb-0 mb-sm-2">Users</h1>
               <nav class="flex-sm-00-auto ml-sm-3" aria-label="breadcrumb">
                    <ol class="breadcrumb">
                         <a href="<?php echo $this->url('admin', array('action' => 'user')); ?>"><li class="breadcrumb-item">Users Details</li></a>
                         <li class="breadcrumb-item active" aria-current="page">&nbsp;/ Edit</li>
                    </ol>
               </nav>
          </div>
     </div>
</div>


<div class="content">
    <div class="block block-rounded block-bordered">
        <div class="block-header block-header-default">
            <h3 class="block-title">Edit Users Details</h3>
        </div>
        <div class="block-content">
            <div class="col-md-12 table-responsive" id="hide">
                <form name="userInformation" id="userInformation"  class="mb-5" action="<?php echo $this->url('admin', array('action' => 'edit-user')); ?>" method="post">
                    <div class="js-wizard-simple block block block-rounded block-bordered">
                        <ul class="nav nav-tabs nav-tabs-block nav-justified" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link active" href="javascript:void(0)" id="step1" onclick="validateStep2();">Edit User Details</a>
                            </li>
                            <li class="nav-item different">
                                <a class="nav-link" href="javascript:void(0)" id="step2" onclick="validateStep1();">Edit Vehicle Details</a>
                            </li>
                        </ul>  
                        <div class="block-content block-content-full tab-content" style="min-height: 300px;">
                            <div class="tab-pane active" id="wizard-progress-step1" role="tabpanel">
                                <div class="form-group row">
                                    <label class="col-sm-2 col-form-label" for="name">Name<span class="mandatory">*</span></label>
                                    <div class="col-sm-4">
                                        <input type="text" value="<?php echo $result['userResult']['name']; ?>"  class="form-control isRequired" id="name" name="name" placeholder="Enter the name" title="Please enter the name">
                                    </div>

                                    <label class="col-sm-2 col-form-label" for="roleName">Role<span class="mandatory">*</span></label>
                                    <div class="col-sm-4">
                                        <select class="form-control isRequired" id="roleName" name="roleName" title="Please select the role name">
                                            <option value="">--Select--</option>
                                            <?php foreach($roleResult as $role){?>
                                                <option value="<?php echo base64_encode($role['role_id']); ?>" <?php echo($result['userResult']['role_id'] == $role['role_id'] )?'selected="selected"':''; ?>><?php echo $role['role_name']; ?></option>
                                            <?php } ?>
                                        </select>
                                    </div>
                                </div>

                                <div class="form-group row">
                                    <label class="col-sm-2 col-form-label" for="email">Email<span class="mandatory">*</span></label>
                                    <div class="col-sm-4">
                                        <input type="email" value="<?php echo $result['userResult']['username']; ?>"  class="form-control isRequired" id="email" name="email" placeholder="Enter the email" title="Please enter the email" onblur="checkNameValidation('user_details', 'username', this,<?php echo 'user_id##'.$result['userResult']['user_id'];?>, 'The email that you entered already exists . Please try another name..');">
                                    </div>

                                    <label class="col-sm-2 col-form-label" for="password">Password</label>
                                    <div class="col-sm-4">
                                        <input type="password" class="form-control" id="password" name="password" placeholder="Enter the Password" title="Please enter the password">
                                    </div>
                                </div>

                                <div class="form-group row">
                                    <label class="col-sm-2 col-form-label" for="mobile">Mobile<span class="mandatory">*</span></label>
                                    <div class="col-sm-4">
                                        <input type="number" value="<?php echo $result['userResult']['phone']; ?>" class="form-control isRequired" id="mobile" name="mobile" placeholder="Enter the mobile" title="Please enter the mobile">
                                    </div>

                                    <label class="col-sm-2 col-form-label" for="dob">DOB</label>
                                    <div class="col-sm-4">
                                            <input type="text" value="<?php echo $common->humanDateFormat($result['userResult']['user_dob']); ?>" class="js-datepicker form-control" id="dob" name="dob" data-week-start="1" data-autoclose="true" data-today-highlight="true" data-date-format="dd-M-yyyy" value="" placeholder="Enter the dob" title="Please enter the dob" readonly="readonly">
                                    </div>
                                </div>

                                <div class="form-group row">
                                    <label class="col-sm-2 col-form-label" for="state">State</label>
                                    <div class="col-sm-4">
                                        <select class="form-control" id="state" name="state" title="Please select the state">
                                            <option value="">--Select--</option>
                                            <?php foreach($stateResult as $state){?>
                                                <option value="<?php echo $state['state_id']; ?>" <?php echo($result['userResult']['state'] == $state['state_id'] )?'selected="selected"':''; ?>><?php echo $state['state_name']; ?></option>
                                            <?php } ?>
                                        </select>
                                    </div>
                                
                                    <label class="col-sm-2 col-form-label" for="city">City</label>
                                    <div class="col-sm-4">
                                        <input type="text" value="<?php echo $result['userResult']['city']; ?>" class="form-control" id="city" name="city" placeholder="Enter the city" title="Please enter the city">
                                    </div>
                                </div>

                                <div class="form-group row">
                                    <label class="col-sm-2 col-form-label" for="pincode">Pincode</label>
                                    <div class="col-sm-4">
                                        <input type="number" value="<?php echo $result['userResult']['pincode']; ?>" class="form-control" id="pincode" name="pincode" placeholder="Enter the pincode" title="Please enter the pincode">
                                    </div>

                                    <label class="col-sm-2 col-form-label" for="userStatus">Status<span class="mandatory">*</span></label>
                                    <div class="col-sm-4">
                                        <select class="form-control isRequired" id="userStatus" name="userStatus" title="Please select the user status">
                                            <option value="active" <?php echo($result['userResult']['user_status'] == 'active' )?'selected="selected"':''; ?>>Active</option>
                                            <option value="inactive" <?php echo($result['userResult']['user_status'] == 'inactive' )?'selected="selected"':''; ?>>Inactive</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="form-group row">
                                    <label class="col-sm-2 col-form-label" for="address">Address</label>
                                    <div class="col-sm-4">
                                        <textarea class="form-control" id="address" rows="4" cols="50" name="address" placeholder="Enter the address" title="Please enter the address"><?php echo $result['userResult']['street_address']; ?></textarea>
                                    </div>
                                </div>
                            </div>

                            <div class="tab-pane" id="wizard-progress-step2" role="tabpanel">
                                <table class="table table-bordered table-condensed table">
                                    <tbody id="vehicleTable" >
                                        <?php foreach($result['vehicleResult'] as $key=>$vehicle){?>
                                            <tr>
                                                <td>
                                                    <div class="form-group row">
                                                        <label class="col-sm-2 col-form-label" for="vehicleNumber<?php echo $key+1;?>">Number <span class="mandatory">*</span></label>
                                                        <div class="col-sm-4">
                                                            <input type="text" class="form-control isRequired" value="<?php echo $vehicle['vehicle_no'];?>" id="vehicleNumber<?php echo $key+1;?>" name="vehicleNumber[]" placeholder="Enter number" title="Please enter number" onblur="checkNameValidation('vehicle_details', 'vehicle_no', this,<?php echo 'vehicle_id##'.$vehicle['vehicle_id'];?>, 'The vehicle number that you entered already exists . Please try another number..'); checkVehicle('1',this);">
                                                            <input type="hidden" value="<?php echo base64_encode($vehicle['vehicle_id']);?>" name="vehicleId[]">
                                                        </div>
                                                        
                                                        <label class="col-sm-2 col-form-label" for="vehicleName<?php echo $key+1;?>">Name <span class="mandatory">*</span></label>
                                                        <div class="col-sm-4">
                                                            <input type="text" class="form-control isRequired" value="<?php echo $vehicle['vehicle_name'];?>" id="vehicleName<?php echo $key+1;?>" name="vehicleName[]" placeholder="Enter name" title="Please enter name"">
                                                        </div>
                                                    </div>

                                                    <div class="form-group row">
                                                        <label class="col-sm-2 col-form-label" for="vehicleBrand<?php echo $key+1;?>">Brand <span class="mandatory">*</span></label>
                                                        <div class="col-sm-4">
                                                            <input type="text" class="form-control isRequired" value="<?php echo $vehicle['vehicle_brand'];?>" id="vehicleBrand<?php echo $key+1;?>" name="vehicleBrand[]" placeholder="Enter brand" title="Please enter brand"">
                                                        </div>
                                                        
                                                        <label class="col-sm-2 col-form-label" for="vehicleModel<?php echo $key+1;?>">Model <span class="mandatory">*</span></label>
                                                        <div class="col-sm-4">
                                                            <input type="text" class="form-control isRequired" value="<?php echo $vehicle['vehicle_model'];?>" id="vehicleModel<?php echo $key+1;?>" name="vehicleModel[]" placeholder="Enter model" title="Please enter model"">
                                                        </div>
                                                    </div>

                                                    <div class="form-group row">
                                                        <label class="col-sm-2 col-form-label" for="vehicleType<?php echo $key+1;?>">Type <span class="mandatory">*</span></label>
                                                        <div class="col-sm-4">
                                                            <input type="text" class="form-control isRequired" value="<?php echo $vehicle['vehicle_type'];?>" id="vehicleType<?php echo $key+1;?>" name="vehicleType[]" placeholder="Enter type" title="Please enter type"">
                                                        </div>
                                                        
                                                        <label class="col-sm-2 col-form-label" for="vehicleVersion<?php echo $key+1;?>">Version <span class="mandatory">*</span></label>
                                                        <div class="col-sm-4">
                                                            <input type="text" class="form-control isRequired" value="<?php echo $vehicle['vehicle_version'];?>" id="vehicleVersion<?php echo $key+1;?>" name="vehicleVersion[]" placeholder="Enter version" title="Please enter version"">
                                                        </div>
                                                    </div>

                                                    <div class="form-group row">
                                                        <label class="col-sm-2 col-form-label" for="yearPurchase<?php echo $key+1;?>">Year of Purchase <span class="mandatory">*</span></label>
                                                        <div class="col-sm-4">
                                                            <input type="text" class="form-control isRequired" value="<?php echo $vehicle['year_of_purchase'];?>" id="yearPurchase<?php echo $key+1;?>" name="yearPurchase[]" placeholder="Enter purchase" title="Please enter purchase">
                                                        </div>
                                                        
                                                        <label class="col-sm-2 col-form-label" for="kmDone<?php echo $key+1;?>">K.M Car Done So Far</label>
                                                        <div class="col-sm-4">
                                                            <input type="text" class="form-control" value="<?php echo $vehicle['km_done'];?>" id="kmDone<?php echo $key+1;?>" name="kmDone[]" placeholder="Enter K.M car done so far" title="Please enter K.M car done so far"">
                                                        </div>
                                                    </div>

                                                    <div class="form-group row">
                                                        <label class="col-sm-2 col-form-label" for="avgDrive<?php echo $key+1;?>">Average Drive Per Week</label>
                                                        <div class="col-sm-4">
                                                            <input type="text" class="form-control" value="<?php echo $vehicle['avg_drive_per_week'];?>" id="avgDrive<?php echo $key+1;?>" name="avgDrive[]" placeholder="Enter average drive per week" title="Please enter average drive per week"">
                                                        </div>
                                                    </div>
                                                </td>

                                                <td style="text-align: center">
                                                    <a href="javascript:void(0);" class="btn btn-info btn-xs" onclick= "insRow(<?php echo $key+1;?>)";><i class="fa fa-plus"> </i></a><br><br><a class="btn btn-round btn-danger btn-xs" onclick= "removeRow(this.parentNode.parentNode);deleteRow('<?php echo base64_encode($vehicle['vehicle_id']);?>');"><i class="fa fa-minus"> </i></a>
                                                </td>
                                            </tr>
                                        <?php }?>
                                    </tbody>
                                </table>  
                            </div>  
                            <input type="hidden" value="<?php echo base64_encode($result['userResult']['user_id']); ?>" name="userId">
                            <input type="hidden" value="" name="deleteId" id="deleteId">
                            <button type="button" class="btn btn-secondary btnHide" onclick="validateStep2();" style="display:none;"><i class="fa fa-angle-left mr-1"></i> Previous</button>
                            <button type="button" class="btn btn-secondary nxtBtn" onclick="validateStep1();" style=" float: right;margin-bottom: 15px; ">Next <i class="fa fa-angle-right ml-1"></i></button>
                            <div class="row items-push submit" style="display:none;">
                                <div class="col-lg-7 offset-lg-4">
                                    <a href="<?php echo $this->url('admin', array('action' => 'user')); ?>" class="btn btn-danger">Cancel</a>&nbsp;
                                    <button type="submit" class="btn btn-primary" onclick="validateNow();return false;"><i class="fa fa-fw fa-check"></i> Submit</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    duplicateName = true;
    var deleteId = [];
    if(document.getElementById("vehicleTable").rows.length == 0){
        insRow(0);
    }
    function validateNow() {
        flag = deforayValidator.init({
            formId: 'userInformation'
        });
        if (flag) {
            if (duplicateName) {
                $.blockUI();
                
                document.getElementById('userInformation').submit();
            }
        }
    }
    function checkNameValidation(tableName, fieldName, obj, fnct, msg)
    {
        checkValue = document.getElementById(obj.id).value;
        if($.trim(checkValue)!= ''){
            $.post("<?php echo $this->url('common', array('action' => 'index')); ?>", { tableName: tableName, fieldName: fieldName, value: checkValue, fnct: fnct},
            function(data) {
                if (data > 0)
                {
                        alert(msg);
                        duplicateName = false;
                        document.getElementById(obj.id).value = "";
                }
                else {
                        duplicateName = true;
                }
            });
        }
    }

    function insRow(key) 
    {
        rowCount = key+1;
        
        rl = document.getElementById("vehicleTable").rows.length;
        var a = document.getElementById("vehicleTable").insertRow(rl);
        a.setAttribute("style", "display:none;");
        a.setAttribute("class", "data");
        var b = a.insertCell(0);
        var c = a.insertCell(1);
        
        c.setAttribute("align", "center");

        b.innerHTML = '<div class="form-group row"><label class="col-sm-2 col-form-label" for="vehicleNumber'+ rowCount +'">Number <span class="mandatory">*</span></label><div class="col-sm-4"><input type="text" class="form-control isRequired" id="vehicleNumber' + rowCount + '" name="vehicleNumber[]" placeholder="Enter number" title="Please enter number" onblur="checkNameValidation("vehicle_details", "vehicle_no", this,null, "The vehicle number that you entered already exists . Please try another number..");checkVehicle("1",this);"></div><label class="col-sm-2 col-form-label" for="vehicleName'+ rowCount +'">Name <span class="mandatory">*</span></label><div class="col-sm-4"><input type="text" class="form-control isRequired" id="vehicleName' + rowCount + '" name="vehicleName[]" placeholder="Enter name" title="Please enter name""></div></div><div class="form-group row"><label class="col-sm-2 col-form-label" for="vehicleBrand'+ rowCount +'">Brand <span class="mandatory">*</span></label><div class="col-sm-4"><input type="text" class="form-control isRequired" id="vehicleBrand' + rowCount + '" name="vehicleBrand[]" placeholder="Enter brand" title="Please enter brand""></div><label class="col-sm-2 col-form-label" for="vehicleModel'+ rowCount +'">Model <span class="mandatory">*</span></label><div class="col-sm-4"><input type="text" class="form-control v" id="vehicleModel' + rowCount + '" name="vehicleModel[]" placeholder="Enter model" title="Please enter model""></div></div><div class="form-group row"><label class="col-sm-2 col-form-label" for="vehicleType'+ rowCount +'">Type <span class="mandatory">*</span></label><div class="col-sm-4"><input type="text" class="form-control isRequired" id="vehicleType' + rowCount + '" name="vehicleType[]" placeholder="Enter type" title="Please enter type""></div><label class="col-sm-2 col-form-label" for="vehicleVersion'+ rowCount +'">Version <span class="mandatory">*</span></label><div class="col-sm-4"><input type="text" class="form-control isRequired" id="vehicleVersion' + rowCount + '" name="vehicleVersion[]" placeholder="Enter version" title="Please enter version""></div></div><div class="form-group row"><label class="col-sm-2 col-form-label" for="yearPurchase'+ rowCount +'">Year of Purchase <span class="mandatory">*</span></label><div class="col-sm-4"><input type="text" class="form-control isRequired" id="yearPurchase' + rowCount + '" name="yearPurchase[]" placeholder="Enter purchase" title="Please enter purchase"></div><label class="col-sm-2 col-form-label" for="kmDone'+ rowCount +'">K.M Car Done So Far</label><div class="col-sm-4"><input type="text" class="form-control" id="kmDone' + rowCount + '" name="kmDone[]" placeholder="Enter K.M car done so far" title="Please enter K.M car done so far""></div></div><div class="form-group row"><label class="col-sm-2 col-form-label" for="avgDrive'+ rowCount +'">Average Drive Per Week</label><div class="col-sm-4"><input type="text" class="form-control" id="avgDrive' + rowCount + '" name="avgDrive[]" placeholder="Enter average drive per week" title="Please enter average drive per week""></div></div>';
        c.innerHTML = '<a href="javascript:void(0);" class="btn btn-info btn-xs" id="addBlock" onclick= "insRow()";><i class="fa fa-plus"> </i></a><br><br><a class="btn btn-round btn-danger btn-xs" onclick= "removeRow(this.parentNode.parentNode);"><i class="fa fa-minus"> </a>';

        $(a).fadeIn(800);
    }

    function removeRow(el) 
    {
        $(el).fadeOut("slow", function() {
            el.parentNode.removeChild(el);
            rl = document.getElementById("vehicleTable").rows.length;
            if (rl == 0) {
                insRow();
            }
        });
    }

    function validateStep1()
    {
        $('#vehicleNumber1').removeClass('isRequired');
        $('#vehicleName1').removeClass('isRequired');
        $('#vehicleBrand1').removeClass('isRequired');
        $('#vehicleModel1').removeClass('isRequired');
        $('#vehicleType1').removeClass('isRequired');
        $('#vehicleVersion1').removeClass('isRequired');
        $('#yearPurchase1').removeClass('isRequired');
        flag = deforayValidator.init({
            formId: 'userInformation'
        });
        if (flag) {
            $("#step1,#wizard-progress-step1").removeClass("active");
            $("#step2,#wizard-progress-step2").addClass("active");

            $(".btnHide").show();
            $(".nxtBtn").hide();
            $('.submit').show();
        }else{
            $('.submit').hide();
            $(".btnHide").hide();
        }
    }

    function validateStep2()
    {
        $("#vehicleNumber1").removeClass("isRequired");
        $("#vehicleName1").removeClass("isRequired");
        $("#vehicleBrand1").removeClass("isRequired");
        $("#vehicleModel1").removeClass("isRequired");
        $("#vehicleType1").removeClass("isRequired");

        $("#step1,#wizard-progress-step1").addClass("active");
        $("#step2,#wizard-progress-step2").removeClass("active");

        $(".btnHide").hide();
        $(".nxtBtn").show();
        $('.submit').hide();
    }

    function deleteRow(id)
    {
        deleteId.push(id);
        $('#deleteId').val(deleteId);
    }
</script>
